#!/usr/bin/make -f
#export DH_VERBOSE=1

PYDEF=$(shell pyversions -d)
PYVERS=$(shell pyversions -r)

build build-indep build-arch: build-stamp
build-stamp: $(PYVERS:%=build-ext-%)
	python setup.py build
	touch $@

build-ext-%:
	# Building for $*
	dh_testdir
	$(subst $(PYDEF),python,$*) setup.py build
	touch $@

install-clean: build-stamp
	dh_clean -k

install: install-clean $(PYVERS:%=install-ext-%)
	python setup.py install --root $(CURDIR)/debian/python-radix

install-ext-%:
	# Installing for $*
	$(subst $(PYDEF),python,$*) setup.py install --root $(CURDIR)/debian/python-radix

binary-indep:

binary-arch: install
	dh_installchangelogs -a ChangeLog
	dh_installdocs -a README
	dh_installman -a
	dh_installexamples -a
	dh_strip -a
	dh_compress -a
	dh_pycentral -a
	dh_fixperms -a
	dh_shlibdeps -a
	dh_installdeb -a
	dh_gencontrol -a
	dh_md5sums -a
	dh_builddeb -a

binary: binary-indep binary-arch

clean:
	dh_testdir
	rm -rf build
	dh_clean build-stamp build-ext-*

.PHONY: build build-indep build-arch clean binary binary-indep binary-arch install configure patch unpatch
